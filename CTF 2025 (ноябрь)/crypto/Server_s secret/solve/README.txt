# CTF Challenge

## Описание задачи

Вам предоставлен архив 1.rar с паролем 12345, внутри которого находится вредоносный PHP-скрипт. Скрипт скрывает полезную нагрузку (payload) внутри многострочного комментария /** ... */, используя сжатие gzinflate и динамическое выполнение кода через create_function.

Задача — извлечь скрытый код и найти флаг.

---

## Шаги решения

### 1. Распаковка архива
Распакуйте файл 1.rar с паролем 12345:

unrar x -p12345 1.rar

После распаковки вы получите файл с именем, например, 1 (без расширения) — это PHP-скрипт.

---

### 2. Анализ структуры скрипта

Откройте файл и обратите внимание на:

- Наличие блока /** ... **/ — внутри него закодирована сжатая полезная нагрузка.
- Использование обфускации через XOR-операции для вызова функций:
  - create_function
  - gzinflate
  - preg_match
  - file
  - implode

Эти функции используются для:
1. Чтения файлом самого себя (file(__FILE__));
2. Извлечения содержимого между /** и **/ с помощью регулярного выражения;
3. Распаковки этого содержимого через gzinflate;
4. Выполнения полученного кода.

---

### 3. Извлечение и распаковка payload

Выполните следующий Python-скрипт, чтобы извлечь и распаковать скрытые данные:

import re
import zlib

# Чтение исходного файла
with open('1', 'rb') as f:
    content = f.read()

# Поиск данных между /** и **/
match = re.search(rb'/\*\*(.*?)\*\*/', content, re.DOTALL)
raw_data = match.group(1)

# Распаковка через gzinflate (raw deflate stream)
payload = zlib.decompress(raw_data, -15)  # -15 для raw deflate
print("Распакованный payload:")
print(payload.decode('utf-8', errors='replace'))

Альтернативно можно использовать онлайн-песочницу PHP, например: https://onlinephp.io/
Вставьте туда:
<?php
echo gzinflate(base64_decode('...')); // вставте сюда закодированный в base64 код из /**...**/
?>

---

### 4. Получение флага

После распаковки вы увидите исходный PHP-код, содержащий флаг в формате:

FECTF{h1dd3n_1n_c0mm3nts_w1th_gz1nfl4t3}

---